import pandas as pd
import numpy as np

# Load the messy dataset
file_path = 'path_to_your_file/messy_sales_and_revenue_analysis.csv'
df = pd.read_csv(file_path)

# 1. Handling Missing Values
# Fill missing numerical values with the median or drop rows

df['Quantity_Sold'] = pd.to_numeric(df['Quantity_Sold'], errors='coerce')
df['Price_per_Unit'] = pd.to_numeric(df['Price_per_Unit'], errors='coerce')
df['Quantity_Sold'].fillna(df['Quantity_Sold'].median(), inplace=True)
df['Price_per_Unit'].fillna(df['Price_per_Unit'].median(), inplace=True)

# Fill missing categorical values with mode or 'Unknown'

df['Region'].fillna('Unknown', inplace=True)
df['Sales_Rep'].fillna('Unknown', inplace=True)

# 2. Standardizing Date Formats
# Convert inconsistent date formats to a consistent format

df['Date'] = pd.to_datetime(df['Date'], errors='coerce')
df['Date'].fillna(method='ffill', inplace=True)

# 3. Correcting Data Types
# Convert numeric columns to the correct data type

df['Total_Revenue'] = df['Quantity_Sold'] * df['Price_per_Unit']
df['Total_Cost'] = df['Quantity_Sold'] * df['Cost_per_Unit']
df['Profit'] = df['Total_Revenue'] - df['Total_Cost']

# 4. Removing Duplicates
# Remove duplicate rows

df.drop_duplicates(inplace=True)

# 5. Fixing Outliers and Inconsistent Data
# Remove outliers by defining a reasonable range for price and quantity

df = df[(df['Quantity_Sold'] >= 0) & (df['Quantity_Sold'] <= 100)]
df = df[(df['Price_per_Unit'] >= 0) & (df['Price_per_Unit'] <= 5000)]

# 6. Correcting Typos
# Standardize text formats and correct typos

df['Product_Name'] = df['Product_Name'].str.strip().str.title()
df['Category'] = df['Category'].str.strip().str.replace("3", "e").str.title()

# Final clean-up and save the cleaned dataset

cleaned_file_path = 'path_to_save_cleaned_dataset/cleaned_sales_and_revenue_analysis.csv'
df.to_csv(cleaned_file_path, index=False)

print("Data cleansing complete. Cleaned dataset saved to:", cleaned_file_path)
